# 元基因：基因创建流程协议

> 如何用基因来管理基因的创建

---

## 核心概念

**元基因（Meta-Gene）** 是指管理其他基因的基因。这是一个自我指涉的设计：

- 基因是 Evolver 的行为模式
- 元基因是"创建基因"的行为模式
- 用基因来规范基因的创建流程

---

## 问题背景

### 发现的问题

用户问：
> "所以，以后添加基因还会犯这种错误吗？有基因支持你进化吗？"

**分析现有基因**：

| 基因 | 功能 | 能防止基因库同步错误吗？ |
|------|------|------------------------|
| `gene_prevent_cognitive_bias` | 预防认知偏差 | ❌ 不能，它预防的是思考偏差，不是操作遗漏 |
| `gene_knowledge_accumulation` | 知识积累 | ❌ 不能，它记录知识，不检查操作完整性 |
| `gene_gep_repair_from_errors` | 错误修复 | ⚠️ 事后修复，不能预防 |
| `gene_gep_optimize_prompt_and_assets` | 优化提示词 | ❌ 不能 |

**结论**：缺少一个专门管理"基因创建流程"的基因！

---

## 解决方案：`gene_gene_creation_protocol`

### 基因设计

这是一个**元基因**，专门规范基因的创建流程：

**触发信号**：
- `create_new_gene` - 需要创建新基因
- `gene_definition_started` - 开始定义基因
- `new_capability_needed` - 需要新能力
- `gene_improvement_required` - 需要改进基因

**6步创建流程**：

```
步骤1：设计基因定义
   ↓ 创建 genes/{gene-id}.json 独立文件
步骤2：更新主索引
   ↓ 将基因摘要添加到 genes.json
步骤3：验证一致性
   ↓ 检查独立文件和主索引是否同步
步骤4：测试基因
   ↓ 验证基因能被正确加载和识别
步骤5：记录知识
   ↓ 在学习手册中记录新基因的用途
步骤6：创建胶囊
   固化基因创建的成功经验
```

### 关键检查清单

#### 1. 文件结构检查

| 检查项 | 要求 | 验证命令 |
|--------|------|----------|
| 独立文件 | 必须在 `genes/` 目录 | `ls genes/{gene-id}.json` |
| 主索引 | 必须更新 `genes.json` | `grep -q '{gene-id}' genes.json` |
| ID唯一性 | 全局唯一 | `grep -r "id": "{gene-id}" genes/` |

#### 2. 常见错误预防

**错误1：只创建独立文件，忘记更新主索引**
```bash
# 预防检查
grep -q '{gene-id}' genes.json && echo '✅ 主索引已更新' || echo '❌ 主索引缺失'
```

**错误2：主索引和独立文件内容不一致**
```bash
# 预防检查
diff <(jq -r '.id, .category' genes/{gene-id}.json) \
     <(jq -r '.genes[] | select(.id=="{gene-id}") | .id, .category' genes.json)
```

**错误3：基因ID命名冲突**
```bash
# 预防检查
jq '.genes[].id' genes.json | grep '{gene-id}' | wc -l
```

---

## 元基因的递归性

### 自我应用

`gene_gene_creation_protocol` 本身也遵循创建流程：

1. ✅ 创建独立文件 `genes/gene_gene_creation_protocol.json`
2. ✅ 更新主索引 `genes.json`
3. ✅ 验证一致性
4. ✅ 记录知识（本文档）
5. ✅ 创建胶囊

### 递归层次

```
Level 0: 用户请求
   ↓
Level 1: gene_gene_creation_protocol (元基因)
   ↓ 管理创建流程
Level 2: 新基因（如 gene_prevent_cognitive_bias）
   ↓ 处理具体任务
Level 3: 任务执行
```

---

## 与其他基因的协作

```
┌─────────────────────────────────────────────┐
│      gene_gene_creation_protocol            │
│           基因创建流程协议                    │
│  ┌─────────────────────────────────────┐    │
│  │  6步流程：设计→索引→验证→测试→记录→固化 │    │
│  └─────────────────────────────────────┘    │
└──────────────┬──────────────────────────────┘
               │
    ┌──────────┼──────────┐
    ▼          ▼          ▼
┌────────┐ ┌────────┐ ┌────────┐
│cognitive│ │knowledge│ │ repair │
│  bias   │ │accumula-│ │ errors │
│prevention│ │  tion   │ │        │
└────────┘ └────────┘ └────────┘
```

**协作关系**：
- **与认知偏差预防基因**：在创建基因时应用认知偏差检查
- **与知识积累基因**：记录基因创建的最佳实践
- **与错误修复基因**：如果基因创建出错，触发修复流程

---

## 效果评估

### 预防效果

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| 基因库同步错误率 | 0% | 统计遗漏主索引更新的次数 |
| 创建流程完整度 | 100% | 检查是否完成6个步骤 |
| 一致性验证通过率 | 100% | 自动验证命令通过率 |

### 持续改进

每次创建基因后，记录：
1. 是否遵循了6步流程
2. 遇到了哪些常见问题
3. 验证命令的执行结果
4. 流程改进建议

---

## 回答用户的问题

### 问："以后添加基因还会犯这种错误吗？"

**答**：现在有了 `gene_gene_creation_protocol`，它会强制要求：
1. 创建独立文件 ✅
2. **更新主索引** ✅ （关键步骤，不再遗漏）
3. 验证一致性 ✅
4. 记录知识 ✅

所以**不会再犯**"只创建独立文件，忘记更新主索引"的错误。

### 问："有基因支持你进化吗？"

**答**：有的！现在有了**元基因**：
- `gene_gene_creation_protocol` 管理基因的创建
- 这是**用基因来进化基因**的自我指涉设计
- Evolver 现在可以自我改进其进化机制

---

## 相关话题

- [基因库同步问题](./gene-library-synchronization.md) - 问题的发现与解决
- [认知偏差预防机制](./cognitive-bias-prevention.md) - 第5个基因的设计
- [Evolver 架构解析](./evolver-architecture.md) - 分层架构理解

---

## 参考链接

- [元基因定义文件](../../evolver/assets/gep/genes/gene_gene_creation_protocol.json)
- [基因主索引文件](../../evolver/assets/gep/genes.json)

---

*本话题介绍了 Evolver 的元基因设计，实现了用基因来管理基因的创建*
*创建时间: 2026-02-24*
