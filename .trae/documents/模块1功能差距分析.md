# ITå®¡è®¡ä¸“å®¶Agent - æ¨¡å—1åŠŸèƒ½å·®è·åˆ†æž

## æ¦‚è¿°

æ¨¡å—1ï¼ˆaudit-item-collectorï¼‰è´Ÿè´£ä»ŽExcelæ–‡ä»¶æ”¶é›†å®¡è®¡é¡¹å¹¶å¯¼å…¥æ•°æ®åº“ã€‚æœ¬æ–‡æ¡£åˆ†æžSKILL.mdè®¾è®¡æ–‡æ¡£ä¸Žå®žé™…å®žçŽ°çš„å·®è·ã€‚

---

## å·²å®žçŽ°åŠŸèƒ½ âœ…

| åŠŸèƒ½ | å®žçŽ°ä½ç½® | çŠ¶æ€ |
|------|----------|------|
| æ™ºèƒ½è§£æžExcel | `excel_parser.py` | âœ… å®Œæ•´ |
| è‡ªåŠ¨è¯†åˆ«è¡¨å¤´ä½ç½® | `excel_parser.py:_find_header_row()` | âœ… å®Œæ•´ |
| åˆ—åæ™ºèƒ½æ˜ å°„ | `excel_parser.py:COLUMN_MAPPING` | âœ… å®Œæ•´ |
| å®Œå…¨é‡å¤æ£€æµ‹ | `db_manager.py:item_exists()` | âœ… å®Œæ•´ |
| æ¥æºè¿½æº¯è®°å½• | `db_manager.py:insert_item_source()` | âœ… å®Œæ•´ |
| æ‰¹æ¬¡ç®¡ç† | `collector.py:import_batch` | âœ… å®Œæ•´ |
| ç»´åº¦è‡ªåŠ¨åˆ›å»º | `db_manager.py:get_or_create_dimension()` | âœ… å®Œæ•´ |
| å‘½ä»¤è¡ŒæŽ¥å£ | `collector.py:main()` | âœ… å®Œæ•´ |

---

## æœªå®žçŽ°åŠŸèƒ½ âŒ

### 1. è¯­ä¹‰ç›¸ä¼¼æ£€æµ‹æœªé›†æˆ

**è®¾è®¡è¦æ±‚**ï¼ˆSKILL.md ç¬¬163-170è¡Œï¼‰ï¼š
```
### è¯­ä¹‰ç›¸ä¼¼ (å¯é€‰)
- ä½¿ç”¨sentence-transformersè®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦
- ç›¸ä¼¼åº¦>85%: è‡ªåŠ¨åˆå¹¶
- ç›¸ä¼¼åº¦60-85%: æç¤ºç”¨æˆ·ç¡®è®¤
```

**çŽ°çŠ¶**ï¼š
- `semantic_matcher.py` å·²å®žçŽ°å®Œæ•´çš„è¯­ä¹‰åŒ¹é…é€»è¾‘
- ä½† **æœªé›†æˆåˆ° `collector.py` çš„å¯¼å…¥æµç¨‹ä¸­**
- å½“å‰åªå®žçŽ°äº†å®Œå…¨é‡å¤æ£€æµ‹ï¼ˆæ ‡é¢˜å®Œå…¨ç›¸åŒï¼‰

**å·®è·**ï¼š
- å¯¼å…¥æ—¶ä¸ä¼šè°ƒç”¨è¯­ä¹‰åŒ¹é…
- ä¸ä¼šè‡ªåŠ¨åˆå¹¶é«˜ç›¸ä¼¼åº¦é¡¹
- ä¸ä¼šæç¤ºç”¨æˆ·ç¡®è®¤ä¸­ç­‰ç›¸ä¼¼åº¦é¡¹

---

### 2. ç”¨æˆ·ç¡®è®¤æ˜ å°„å…³ç³»æµç¨‹ç¼ºå¤±

**è®¾è®¡è¦æ±‚**ï¼ˆSKILL.md ç¬¬53-77è¡Œï¼‰ï¼š
```
### æ­¥éª¤3: ç¡®è®¤æ˜ å°„å…³ç³»

å‘ç”¨æˆ·å±•ç¤ºè¯†åˆ«ç»“æžœå¹¶ç¡®è®¤ï¼š

ðŸ“Š Excelæ–‡ä»¶åˆ†æžç»“æžœ
æ–‡ä»¶: xxx.xls
...
æ˜¯å¦ç¡®è®¤æ­¤æ˜ å°„ï¼Ÿ[Y/n] æˆ–æä¾›ä¿®æ”¹å»ºè®®
```

**çŽ°çŠ¶**ï¼š
- `collector.py` ç›´æŽ¥æ‰§è¡Œå¯¼å…¥ï¼Œæ— ç¡®è®¤æ­¥éª¤
- ç”¨æˆ·æ— æ³•åœ¨å¯¼å…¥å‰æŸ¥çœ‹å’Œä¿®æ”¹æ˜ å°„å…³ç³»

---

### 3. å†²çªè®°å½•è¡¨æœªä½¿ç”¨

**è®¾è®¡è¦æ±‚**ï¼š
æ•°æ®åº“ä¸­å·²åˆ›å»º `audit_item_conflicts` è¡¨ï¼Œç”¨äºŽè®°å½•å†²çªè¯¦æƒ…

**çŽ°çŠ¶**ï¼š
- è¡¨ç»“æž„å­˜åœ¨ï¼ˆ`db_manager.py` ç¬¬100-114è¡Œï¼‰
- **æ²¡æœ‰ä»»ä½•ä»£ç å†™å…¥è¯¥è¡¨**
- å†²çªæ£€æµ‹åŽç›´æŽ¥è·³è¿‡ï¼Œä¸è®°å½•å†²çªè¯¦æƒ…

---

### 4. å®¡è®¡ç¨‹åºå‘é‡æœªå­˜å‚¨

**çŽ°çŠ¶**ï¼š
- `semantic_matcher.py` éœ€è¦å·²æœ‰å®¡è®¡é¡¹çš„å‘é‡è¿›è¡ŒåŒ¹é…
- æ•°æ®åº“ä¸­æ²¡æœ‰å­˜å‚¨ `title_vector` å­—æ®µ
- æ¯æ¬¡åŒ¹é…éƒ½éœ€è¦é‡æ–°è®¡ç®—å‘é‡ï¼Œæ•ˆçŽ‡ä½Žä¸‹

---

### 5. å•å…ƒæµ‹è¯•ç¼ºå¤±

**çŽ°çŠ¶**ï¼š
- æ—  `tests/` ç›®å½•
- æ— æµ‹è¯•æ–‡ä»¶
- æ— æ³•éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§

---

### 6. ä¾èµ–ç®¡ç†ç¼ºå¤±

**çŽ°çŠ¶**ï¼š
- æ—  `requirements.txt`
- ä¾èµ–éšå«åœ¨ä»£ç ä¸­ï¼ˆpandas, numpy, sentence-transformersï¼‰

---

## åŠŸèƒ½å·®è·æ±‡æ€»

| åºå· | åŠŸèƒ½ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ |
|------|------|--------|--------|
| 1 | é›†æˆè¯­ä¹‰ç›¸ä¼¼æ£€æµ‹åˆ°å¯¼å…¥æµç¨‹ | é«˜ | ä¸­ |
| 2 | æ·»åŠ ç”¨æˆ·ç¡®è®¤æ˜ å°„å…³ç³»æ­¥éª¤ | ä¸­ | å° |
| 3 | å®žçŽ°å†²çªè®°å½•å†™å…¥ | ä¸­ | å° |
| 4 | æ·»åŠ å‘é‡å­˜å‚¨å’Œç¼“å­˜ | ä½Ž | ä¸­ |
| 5 | ç¼–å†™å•å…ƒæµ‹è¯• | é«˜ | ä¸­ |
| 6 | åˆ›å»º requirements.txt | é«˜ | å° |

---

## å»ºè®®å®žæ–½é¡ºåº

1. **ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®Œå–„**
   - åˆ›å»º `requirements.txt`
   - æ·»åŠ ç”¨æˆ·ç¡®è®¤æ˜ å°„å…³ç³»æ­¥éª¤

2. **ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½é›†æˆ**
   - é›†æˆè¯­ä¹‰ç›¸ä¼¼æ£€æµ‹åˆ°å¯¼å…¥æµç¨‹
   - å®žçŽ°å†²çªè®°å½•å†™å…¥

3. **ç¬¬ä¸‰é˜¶æ®µï¼šè´¨é‡ä¿éšœ**
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - æ·»åŠ å‘é‡å­˜å‚¨ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

---

## è¯¦ç»†å®žçŽ°å»ºè®®

### 1. é›†æˆè¯­ä¹‰ç›¸ä¼¼æ£€æµ‹

ä¿®æ”¹ `collector.py`ï¼Œåœ¨å¯¼å…¥å‰è°ƒç”¨è¯­ä¹‰åŒ¹é…ï¼š

```python
from semantic_matcher import SemanticMatcher

class AuditItemCollector:
    def __init__(self, ...):
        ...
        self.matcher = SemanticMatcher()  # æ–°å¢ž
    
    def collect_from_excel(self, file_path, skip_existing=True, use_semantic=True):
        if use_semantic:
            existing_items = self.db.get_all_items_with_vectors()
            match_result = self.matcher.batch_match(items, existing_items)
            # æ ¹æ® match_result å¤„ç†åˆå¹¶/æ–°å»º/å¾…å®¡æ ¸
```

### 2. æ·»åŠ ç”¨æˆ·ç¡®è®¤æ­¥éª¤

åœ¨ `collector.py` ä¸­æ·»åŠ ï¼š

```python
def confirm_mapping(self, structure: Dict) -> bool:
    """å±•ç¤ºæ˜ å°„å…³ç³»å¹¶è¯·æ±‚ç”¨æˆ·ç¡®è®¤"""
    print(f"\nðŸ“Š Excelæ–‡ä»¶åˆ†æžç»“æžœ")
    print(f"æ–‡ä»¶: {structure['file_name']}")
    ...
    response = input("\næ˜¯å¦ç¡®è®¤æ­¤æ˜ å°„ï¼Ÿ[Y/n]: ")
    return response.lower() in ['y', 'yes', '']
```

### 3. å®žçŽ°å†²çªè®°å½•

åœ¨ `db_manager.py` ä¸­æ·»åŠ ï¼š

```python
def record_conflict(self, item_a_id, item_b_id, conflict_type, similarity):
    """è®°å½•å†²çªè¯¦æƒ…"""
    cursor.execute('''
        INSERT INTO audit_item_conflicts 
        (item_a_id, item_b_id, conflict_type, similarity_score)
        VALUES (?, ?, ?, ?)
    ''', (item_a_id, item_b_id, conflict_type, similarity))
```

### 4. åˆ›å»º requirements.txt

```
pandas>=1.3.0
numpy>=1.20.0
sentence-transformers>=2.2.0
openpyxl>=3.0.0
xlrd>=2.0.0
```
