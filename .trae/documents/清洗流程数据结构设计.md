# 模块一清洗流程数据结构设计

## 核心思路

```
向量模型 → 输出合并建议文档(JSON) → 大模型审核 → 调整 → 再审核 → OK → 入库
```

**优势**：
- 大模型看到全局视图，判断更准确
- 只需几次LLM调用，不是每对都调用
- 迭代优化，效率更高

---

## 一、向量模型输出结构

```json
{
  "version": "1.0",
  "created_at": "2026-02-25T22:00:00",
  "source_file": "审计项-2022.xls",
  
  "summary": {
    "total_new_items": 200,
    "total_existing_items": 600,
    "suggested_new_items": 120,
    "suggested_merge_items": 80,
    "pending_review": 15
  },
  
  "merge_suggestions": [
    {
      "suggestion_id": "M001",
      "new_item": {
        "title": "公司是否建立IT治理委员会",
        "dimension": "信息技术治理",
        "procedure": "查阅IT治理委员会成立发文"
      },
      "match_result": {
        "existing_item_id": "IT-GOV-0015",
        "existing_title": "是否设立IT治理委员会",
        "similarity": 0.92,
        "action": "merge"
      },
      "procedure_match": {
        "existing_procedure": "查阅公司是否制定IT治理委员会成立文件",
        "similarity": 0.88,
        "action": "new_procedure"
      },
      "vector_confidence": "high"
    },
    {
      "suggestion_id": "M002",
      "new_item": {
        "title": "IT治理委员会是否有效运作",
        "dimension": "信息技术治理",
        "procedure": "查阅IT治理委员会会议记录"
      },
      "match_result": {
        "existing_item_id": "IT-GOV-0015",
        "existing_title": "是否设立IT治理委员会",
        "similarity": 0.88,
        "action": "merge"
      },
      "procedure_match": {
        "existing_procedure": "查阅IT治理委员会成立发文",
        "similarity": 0.75,
        "action": "new_procedure"
      },
      "vector_confidence": "medium",
      "note": "相似度高但检查重点可能不同"
    },
    {
      "suggestion_id": "M003",
      "new_item": {
        "title": "是否制定数据分类分级管理制度",
        "dimension": "数据安全",
        "procedure": "查阅数据分类分级管理制度文件"
      },
      "match_result": {
        "existing_item_id": null,
        "existing_title": null,
        "similarity": 0.55,
        "action": "new_item"
      },
      "best_match": {
        "existing_item_id": "IT-DS-0008",
        "existing_title": "是否建立数据安全管理制度",
        "similarity": 0.55
      },
      "vector_confidence": "high"
    }
  ],
  
  "pending_review": [
    {
      "suggestion_id": "P001",
      "new_item": {
        "title": "是否定期开展网络安全培训",
        "dimension": "安全管理",
        "procedure": "查阅培训记录"
      },
      "candidates": [
        {
          "existing_item_id": "IT-SEC-0023",
          "existing_title": "是否制定安全培训计划",
          "similarity": 0.72
        },
        {
          "existing_item_id": "IT-SEC-0045",
          "existing_title": "员工是否接受安全意识教育",
          "similarity": 0.68
        }
      ],
      "vector_confidence": "low",
      "note": "相似度中等，需人工判断"
    }
  ]
}
```

---

## 二、字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| suggestion_id | string | 建议编号，用于追踪 |
| new_item.title | string | 新审计项标题 |
| new_item.dimension | string | 新审计项维度 |
| new_item.procedure | string | 新审计程序 |
| match_result.existing_item_id | string | 匹配到的已有审计项ID，null表示新建 |
| match_result.similarity | float | 相似度 0-1 |
| match_result.action | string | merge(合并) / new_item(新建) |
| procedure_match.action | string | merge_procedure(合并程序) / new_procedure(新增程序) |
| vector_confidence | string | high/medium/low 向量模型置信度 |
| note | string | 备注说明 |

---

## 三、大模型审核Prompt

```
你是一个IT审计专家。我正在将新的审计项导入审计知识库，需要你审核向量模型的匹配建议。

## 输入数据结构说明

我将提供一个JSON格式的合并建议文档，结构如下：
- summary: 统计信息
- merge_suggestions: 合并建议列表
  - suggestion_id: 建议编号
  - new_item: 新审计项信息
  - match_result: 匹配结果（action: merge/new_item）
  - procedure_match: 审计程序匹配结果
  - vector_confidence: 向量模型置信度
- pending_review: 待确认列表（相似度中等的候选）

## 审核任务

对于每条建议，请判断：
1. match_result.action 是否正确？
   - merge: 两个审计项是否真的是同一个检查项？
   - new_item: 是否确实应该新建？
2. procedure_match.action 是否正确？
   - 审计程序是否可以合并，还是应该新增？
3. 维度分类是否合理？

## 判断标准

- 合并条件：检查重点相同、检查对象相同
- 分离条件：检查重点不同、存在包含关系
- 审计程序：检查方法或检查对象不同时，应新增程序

## 输出格式

请输出JSON格式：

{
  "review_id": "R001",
  "overall_assessment": "整体评价",
  "adjustments": [
    {
      "suggestion_id": "M002",
      "field": "match_result.action",
      "original_value": "merge",
      "new_value": "new_item",
      "reason": "检查重点不同：M002检查运作是否有效，已有项检查是否建立"
    }
  ],
  "approved_count": 78,
  "adjusted_count": 2,
  "status": "approved / need_revision"
}

## 合并建议文档

{json_content}
```

---

## 四、大模型输出示例

```json
{
  "review_id": "R001",
  "overall_assessment": "大部分合并建议合理，有2处需要调整",
  
  "adjustments": [
    {
      "suggestion_id": "M002",
      "field": "match_result.action",
      "original_value": "merge",
      "new_value": "new_item",
      "reason": "M002检查的是'运作是否有效'，而IT-GOV-0015检查的是'是否建立'，检查重点不同，不应合并"
    },
    {
      "suggestion_id": "P001",
      "field": "match_result.action",
      "original_value": "pending",
      "new_value": "merge",
      "target_item_id": "IT-SEC-0023",
      "reason": "'定期开展培训'是'培训计划'的执行层面，属于同一检查项"
    }
  ],
  
  "approved_count": 78,
  "adjusted_count": 2,
  "status": "need_revision"
}
```

---

## 五、调整后再次提交

根据大模型意见调整JSON后，再次提交：

```json
{
  "version": "1.1",
  "revision_of": "1.0",
  "revisions": [
    {
      "suggestion_id": "M002",
      "original_action": "merge",
      "new_action": "new_item",
      "reason": "根据LLM审核意见R001调整"
    },
    {
      "suggestion_id": "P001",
      "original_action": "pending",
      "new_action": "merge",
      "target_item_id": "IT-SEC-0023",
      "reason": "根据LLM审核意见R001调整"
    }
  ]
}
```

大模型确认：

```json
{
  "review_id": "R002",
  "overall_assessment": "所有调整已正确",
  "adjustments": [],
  "status": "approved"
}
```

---

## 六、完整流程

```
┌─────────────────────────────────────────────────────────────────┐
│ 第1步：向量模型分析                                              │
│   输入: 200条新 + 600条已有                                      │
│   输出: 合并建议文档 v1.0 (JSON)                                 │
│   耗时: 约10秒                                                   │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│ 第2步：大模型审核                                                │
│   输入: 合并建议文档 + Prompt                                    │
│   输出: 审核意见 (JSON)                                          │
│   耗时: 约30秒                                                   │
│   成本: 约0.2元                                                  │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
                    ┌────────┴────────┐
                    │ status=?         │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
         need_revision   approved      approved
              │              │              │
              ▼              ▼              ▼
    ┌─────────────────┐   入库         入库
    │ 第3步: 调整文档  │
    │ 输出: v1.1      │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 第4步: 再次审核  │
    │ (循环直到OK)    │
    └─────────────────┘
```

---

## 七、成本估算

| 步骤 | 调用次数 | 成本 |
|------|----------|------|
| 向量分析 | 1次（本地） | 0元 |
| LLM审核 | 2-3次 | 0.4-0.6元 |
| **总计** | - | **< 1元** |

**对比原方案**：从几万元降到不到1元
